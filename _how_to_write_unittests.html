<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Learning To Rank Library: How to write unittests</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://www.mathjax.org/mathjax/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Learning To Rank Library
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="header">
  <div class="headertitle">
<div class="title">How to write unittests </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#UnittestsGTest">GTest</a></li>
<li class="level1"><a href="#UnittestsBasics">Basics</a></li>
<li class="level1"><a href="#UnittestsAssertions">Assertions</a></li>
<li class="level1"><a href="#UnittestsRunning">Running unittests</a></li>
</ul>
</div>
<div class="textblock"><h2><a class="anchor" id="UnittestsGTest"></a>
GTest</h2>
<p>In LTR we use googletest testing framework from <a href="http://code.google.com/p/googletest">http://code.google.com/p/googletest</a>. This document is a very short introduction to unittesting, for more information see the documentation here <a href="http://code.google.com/p/googletest/wiki/Documentation">http://code.google.com/p/googletest/wiki/Documentation</a>.</p>
<h2><a class="anchor" id="UnittestsBasics"></a>
Basics</h2>
<p>Unittest is a code, which uses some staff from our library which is needed to be checked, and verifies if while running that staff certain assertions do not fail.</p>
<p>To create a unittest one takes a .cc file, already listed in &lt;LTR_ROOT&gt;/cmake/utests.cmake, which contains files for ltr_test project, or creates a new one in the folder with the files to be tested, and adds the new file to the list. In the file the main piece of code, within which your test code would be placed, is as follows:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span> <span class="comment">// the main include for testing</span>

<span class="comment">// ...</span>

<a class="code" href="aggregators__unittest_8cc.html#aa9f6b3b4a260b1baea4a30975e3ad1f3">TEST</a>(TestSetName, TestName) {

<span class="comment">// ... your code here ...</span>

}
</pre></div><p>TestName here is the name of the test that you will see in a report. For convinience usually closely-related tests are packed in the test sets, the name of the one here is TestSetName. Also, TEST is a gtest macro, defined in gtest.h.</p>
<h2><a class="anchor" id="UnittestsAssertions"></a>
Assertions</h2>
<p>Now lets put some code to be tested inside TEST macro and use some assertions, provided by gtest.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span>

<a class="code" href="aggregators__unittest_8cc.html#aa9f6b3b4a260b1baea4a30975e3ad1f3">TEST</a>(ObviousTests, ComparisonTest) {
  <span class="keywordtype">int</span> a = 1;
  <span class="keywordtype">int</span> b = -2;
  EXPECT_TRUE(a &gt; 0);
  EXPECT_FALSE(b &gt; 0);
  EXPECT_GT(a, b); <span class="comment">// checks if a &gt; b</span>
}
<span class="comment">// there could be more than one TEST macro in one file</span>
<a class="code" href="aggregators__unittest_8cc.html#aa9f6b3b4a260b1baea4a30975e3ad1f3">TEST</a>(ObviousTests, SumTest) {
  <span class="keywordtype">int</span> a = 1;
  <span class="keywordtype">int</span> b = -2;
  EXPECT_EQ(-1, a + b); <span class="comment">// checks if parameters are equal</span>
}

<a class="code" href="aggregators__unittest_8cc.html#aa9f6b3b4a260b1baea4a30975e3ad1f3">TEST</a>(ObviousTests, DivisionThrowTest) {
  <span class="keywordtype">int</span> a = 1;
  <span class="keywordtype">int</span> b = -2;
  EXPECT_NO_THROW(a / b); <span class="comment">// checks if while processing the command in brackets no exceptions were thrown</span>
  <span class="comment">// there is also an EXPECT_ANY_THROW macro, which checks the opposite</span>
}
</pre></div><p>Every code within any TEST macro will be compiled and ran separately, and if while testing any of the EXPECT assertions would be failed, you'll see a report on that.</p>
<p>One may see that all the tests from the previous example use the same variables. There is a way to shorten the code with the help of TEST_F macro.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span> 

<span class="comment">// the name of the class here is the name of a test set</span>
<span class="keyword">class </span>ObviousTests : <span class="keyword">public</span> ::testing::Test {
 <span class="keyword">protected</span>:
  <span class="keyword">virtual</span> <span class="keywordtype">void</span> SetUp() { <span class="comment">// doing something before a test run, e.g. setting variables</span>
    a = 1; <span class="comment">// initializing variables</span>
    b = -2;
  }
  <span class="keyword">virtual</span> <span class="keywordtype">void</span> TearDown() { <span class="comment">// doing something after a test run, e.g. free memory</span>
  }

  <span class="keywordtype">int</span> a, b; <span class="comment">// variables used in all tests of the test set</span>
};

<a class="code" href="k__fold__simple__splitter__unittest_8cc.html#a5bebb1d9e2c11bd80d1d139379de1e98">TEST_F</a>(ObviousTests, ComparisonTest) {
  EXPECT_TRUE(a &gt; 0);  <span class="comment">// variables a and b are already initialized in the ObviousTests class</span>
  EXPECT_FALSE(b &gt; 0); <span class="comment">// and one can use them here without defining</span>
  EXPECT_GT(a, b);
}

<a class="code" href="k__fold__simple__splitter__unittest_8cc.html#a5bebb1d9e2c11bd80d1d139379de1e98">TEST_F</a>(ObviousTests, SumTest) {
  EXPECT_EQ(-1, a + b);
}

<a class="code" href="k__fold__simple__splitter__unittest_8cc.html#a5bebb1d9e2c11bd80d1d139379de1e98">TEST_F</a>(ObviousTests, DivisionThrowTest) {
  EXPECT_NO_THROW(a / b);
}
</pre></div><h2><a class="anchor" id="UnittestsRunning"></a>
Running unittests</h2>
<p>See <a class="el" href="_how_to_install.html#BuildingLTR">Building LTR</a> for detail information. </p>
</div></div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed Sep 19 2012 12:52:08 for Learning To Rank Library by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
